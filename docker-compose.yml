# CREATED BY Bruno 
services:
#  _____                       ______            
# |  __ \                     |  ____|           
# | |__) | __ _____  ___   _  | |__   _ ____   __
# |  ___/ '__/ _ \ \/ / | | | |  __| | '_ \ \ / /
# | |   | | | (_) >  <| |_| | | |____| | | \ V / 
# |_|   |_|  \___/_/\_\\__, | |______|_| |_|\_(_)
#                       __/ |                    
#                      |___/                     

  proxy:
    image: "jc21/nginx-proxy-manager:latest"
    container_name: "Proxy"
    restart: "unless-stopped"
    depends_on:
      proxy_db:
        condition: "service_started"
    environment:
      DB_MYSQL_HOST: "proxy_db"
      DB_MYSQL_PORT: 3306
      DB_MYSQL_USER: $PROXY_DB_USER
      DB_MYSQL_PASSWORD: $PROXY_DB_PASSWORD
      DB_MYSQL_NAME: $PROXY_DB_NAME
      DISABLE_IPV6: 'true'
    volumes:
      - prx_data:/data
      - prx_letsencrypt:/etc/letsencrypt
    networks: ["sys_net"]
    ports:
      - '80:80'
      - '443:443'
      - '81:81'

  proxy_db:
    image: 'jc21/mariadb-aria:latest'
    container_name: "proxy_db"
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: 'npm'
      MYSQL_DATABASE: 'npm'
      MYSQL_USER: 'npm'
      MYSQL_PASSWORD: 'npm'
      MARIADB_AUTO_UPGRADE: '1'
    volumes:
      - ./mysql:/var/lib/mysql

#  _    _ _   _ _ _ _         
# | |  | | | (_) (_) |        
# | |  | | |_ _| |_| |_ _   _ 
# | |  | | __| | | | __| | | |
# | |__| | |_| | | | |_| |_| |
#  \____/ \__|_|_|_|\__|\__, |
#                        __/ |
#                       |___/ 

# <-- PLACEHOLDER -->

#  _    _      _                                  
# | |  | |    | |                                 
# | |  | | ___| |__  ___  ___ _ ____   _____ _ __ 
# | |/\| |/ _ \ '_ \/ __|/ _ \ '__\ \ / / _ \ '__|
# \  /\  /  __/ |_) \__ \  __/ |   \ V /  __/ |   
#  \/  \/ \___|_.__/|___/\___|_|    \_/ \___|_|   

# Cyberbear Lab - lab.cyberbear.me
  cyberbearlab:
    image: "php:8.2-apache"
    container_name: "CyberbearLab"
    depends_on:
      proxy:
        condition: "service_started"
    restart: "always"
    environment:
      - "VIRTUAL_HOST=$VH_CYBERBEAR_LAB"
    volumes:
      - "cbl_webroot:/var/www/html/"
    networks: ["web_net"]

# ASZ Scholz - asz-scholz.de
  aszscholz:
    image: "php:8.2-apache"
    container_name: "ASZ-Scholz"
    depends_on:
      proxy:
        condition: "service_started"
    restart: "always"
    environment:
      - "VIRTUAL_HOST=VH_AUTOHAUS"
    volumes:
      - "asz_webroot:/var/www/html/"
    networks: ["web_net"]


#  _   _      _                      _        
# | \ | |    | |                    | |       
# |  \| | ___| |___      _____  _ __| | _____ 
# | . ` |/ _ \ __\ \ /\ / / _ \| '__| |/ / __|
# | |\  |  __/ |_ \ V  V / (_) | |  |   <\__ \
# |_| \_|\___|\__| \_/\_/ \___/|_|  |_|\_\___/

networks: # 172.21.0.0/16
# System
  sys_net: # 172.21.1.0/24
    name: "sys_net"
    driver: "bridge"
    ipam:
      config:
        - subnet: "172.21.1.0/24"
          ip_range: "172.21.1.0/24"
          gateway: "172.21.1.1"
# Utility Net
  utl_net: # 172.21.2.0/24
    name: "utl_net"
    driver: "bridge"
    ipam:
      config:
        - subnet: "172.21.2.0/24"
          ip_range: "172.21.2.0/24"
          gateway: "172.21.2.1"
# Webserver Net
  web_net: # 172.21.3.0/24
    name: "web_net"
    driver: "bridge"
    ipam:
      config:
        - subnet: "172.21.3.0/24"
          ip_range: "172.21.3.0/24"
          gateway: "172.21.3.1"
  
# __      __   _                           
# \ \    / /  | |                          
#  \ \  / /__ | |_   _ _ __ ___   ___  ___ 
#   \ \/ / _ \| | | | | '_ ` _ \ / _ \/ __|
#    \  / (_) | | |_| | | | | | |  __/\__ \
#     \/ \___/|_|\__,_|_| |_| |_|\___||___/

volumes:
  prx_data:
    name: "prx_data"
  prx_letsencrypt:
    name: "prx_letsencrypt"

  cbl_webroot: # Cyberbear Lab
    name: "cbl_webroot"
  asz_webroot: # ASZ Webroot
    name: "asz_webroot"

# CREATED BY Bruno
